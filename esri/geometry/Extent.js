// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.

define(["../core/declare","dojo/_base/array","dojo/_base/lang","dojo/_base/kernel","../core/lang","./SpatialReference","./Geometry","./Point","./support/webMercatorUtils","./support/mathUtils"],function(t,i,n,e,s,a,r,h,m,x){var c=t(r,{declaredClass:"esri.geometry.Extent",classMetadata:{properties:{cache:{dependsOn:["xmin","ymin","zmin","mmin","xmax","ymax","zmax","mmax"]},center:{dependsOn:["cache"]},extent:{dependsOn:["cache"]},hasM:{dependsOn:["mmin","mmax"]},hasZ:{dependsOn:["zmin","zmax"]},height:{dependsOn:["ymin","ymax"]},width:{dependsOn:["xmin","xmax"]}}},normalizeCtorArgs:function(t,i,e,s,r){return this.isSR(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:n.isObject(t)?(t.spatialReference=t.spatialReference||a.WGS84,t):{xmin:t,ymin:i,xmax:e,ymax:s,spatialReference:r||a.WGS84}},_centerGetter:function(t){return t||(t=new h({spatialReference:this.spatialReference})),t.x=.5*(this.xmin+this.xmax),t.y=.5*(this.ymin+this.ymax),this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t},_extentGetter:function(){return this.clone()},_hasMGetter:function(){return null!=this.mmin&&null!=this.mmax},_hasZGetter:function(){return null!=this.zmin&&null!=this.zmax},_heightGetter:function(){return Math.abs(this.ymax-this.ymin)},type:"extent",_widthGetter:function(){return Math.abs(this.xmax-this.xmin)},xmin:0,ymin:0,mmin:void 0,zmin:void 0,xmax:0,ymax:0,mmax:void 0,zmax:void 0,centerAt:function(t){var i=this.center;return null!=t.z&&this.hasZ?this.offset(t.x-i.x,t.y-i.y,t.z-i.z):this.offset(t.x-i.x,t.y-i.y)},clone:function(){var t=new c;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,null!=this.zmin&&(t.zmin=this.zmin,t.zmax=this.zmax),null!=this.mmin&&(t.mmin=this.mmin,t.mmax=this.mmax),t},contains:function(t){if(!t)return!1;var i=t.type;if("point"===i){var n,e=this.spatialReference,s=t.spatialReference,a=t.x,r=t.y,m=t.z;return e&&s&&!e.equals(s)&&e._canProject(s)&&(n=e.isWebMercator?h.lngLatToXY(a,r):h.xyToLngLat(a,r,!0),a=n[0],r=n[1]),a>=this.xmin&&a<=this.xmax&&r>=this.ymin&&r<=this.ymax?null!=m&&this.hasZ?m>=this.zmin&&m<=this.zmax:!0:!1}return"extent"===i?this._containsExtent(t):!1},equals:function(t){if(!t)return!1;var i=this.spatialReference;if(!i.equals(t.spatialReference)){if(!m.canProject(t.spatialReference,i))return!1;t=m.project(t,i)}return this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax},expand:function(t){var i=.5*(1-t),n=this.width*i,e=this.height*i;if(this.xmin+=n,this.ymin+=e,this.xmax-=n,this.ymax-=e,this.hasZ){var s=(this.zmax-this.zmin)*i;this.zmin+=s,this.zmax-=s}if(this.hasM){var a=(this.mmax-this.mmin)*i;this.mmin+=a,this.mmax-=a}return this},intersects:function(t){if(!t)return!1;var i=t.type,n=this.spatialReference,e=t.spatialReference;switch(n&&e&&!n.equals(e)&&n._canProject(e)&&(t=n.isWebMercator?m.geographicToWebMercator(t):m.webMercatorToGeographic(t,!0)),i){case"point":return this.contains(t);case"multipoint":return this._intersectsMultipoint(t);case"extent":return this._intersectsExtent(t);case"polygon":return this._intersectsPolygon(t);case"polyline":return this._intersectsPolyline(t)}},normalize:function(){var t=this._normalize(!1,!0);return Array.isArray(t)||(t=[t]),t},offset:function(t,i,n){return this.xmin+=t,this.ymin+=i,this.xmax+=t,this.ymax+=i,null!=n&&(this.zmin+=n,this.zmax+=n),this},shiftCentralMeridian:function(){return this._normalize(!0)},toJSON:function(){var t=this.spatialReference,i={xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax,spatialReference:t&&t.toJSON()};return this.hasZ&&(i.zmin=this.zmin,i.zmax=this.zmax),this.hasM&&(i.mmax=this.mmax,i.mmin=this.mmin),i},union:function(t){function i(t,i,n){return null==i?n:null==n?i:t(i,n)}return this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=i(Math.min,this.zmin,t.zmin),this.zmax=i(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=i(Math.min,this.mmin,t.mmin),this.mmax=i(Math.max,this.mmax,t.mmax)),this},_containsExtent:function(t){var i=t.xmin,n=t.ymin,e=t.zmin,s=t.xmax,a=t.ymax,r=t.zmax,m=t.spatialReference;return null!=e&&this.hasZ?this.contains(new h(i,n,e,m))&&this.contains(new h(i,a,e,m))&&this.contains(new h(s,a,e,m))&&this.contains(new h(s,n,e,m))&&this.contains(new h(i,n,r,m))&&this.contains(new h(i,a,r,m))&&this.contains(new h(s,a,r,m))&&this.contains(new h(s,n,r,m)):this.contains(new h(i,n,m))&&this.contains(new h(i,a,m))&&this.contains(new h(s,a,m))&&this.contains(new h(s,n,m))},_intersectsMultipoint:function(t){var i,n=t.points.length;for(i=0;n>i;i++)if(this.contains(t.getPoint(i)))return!0;return!1},_intersectsExtent:function(t){var i,n,e,s=this.hasZ&&t.hasZ;if(this.xmin<=t.xmin){if(i=t.xmin,this.xmax<i)return!1}else if(i=this.xmin,t.xmax<i)return!1;if(this.ymin<=t.ymin){if(n=t.ymin,this.ymax<n)return!1}else if(n=this.ymin,t.ymax<n)return!1;if(s)if(this.zmin<=t.zmin){if(e=t.zmin,this.zmax<e)return!1}else if(e=this.zmin,t.zmax<e)return!1;return!0},_intersectsPolygon:function(t){var i,n,e,s,a=[this.xmin,this.ymax],r=[this.xmax,this.ymax],m=[this.xmin,this.ymin],x=[this.xmax,this.ymin],c=[a,r,m,x],o=[[m,a],[a,r],[r,x],[x,m]],f=t.rings,u=f.length,l=new h(0,0,this.spatialReference);for(s=c.length,i=0;s>i;i++)if(l.x=c[i][0],l.y=c[i][1],t.contains(l))return!0;l={x:0,y:0,spatialReference:t.spatialReference,type:"point"};var y,p;for(i=0;u>i;i++)if(e=f[i],s=e.length){if(y=e[0],l.x=y[0],l.y=y[1],this.contains(l))return!0;for(n=1;s>n;n++){if(p=e[n],l.x=p[0],l.y=p[1],this.contains(l)||this._intersectsLine([y,p],o))return!0;y=p}}return!1},_intersectsPolyline:function(t){var i,n,e,s,a,r,h=[[[this.xmin,this.ymin],[this.xmin,this.ymax]],[[this.xmin,this.ymax],[this.xmax,this.ymax]],[[this.xmax,this.ymax],[this.xmax,this.ymin]],[[this.xmax,this.ymin],[this.xmin,this.ymin]]],m=t.paths,x=m.length,c={x:0,y:0,spatialReference:t.spatialReference,type:"point"};for(i=0;x>i;i++)if(e=m[i],s=e.length){if(a=e[0],c.x=a[0],c.y=a[1],this.contains(c))return!0;for(n=1;s>n;n++){if(r=e[n],c.x=r[0],c.y=r[1],this.contains(c)||this._intersectsLine([a,r],h))return!0;a=r}}return!1},_intersectsLine:function(t,i){var n,e=x._getLineIntersection2,s=i.length;for(n=0;s>n;n++)if(e(t,i[n]))return!0;return!1},_shiftCM:function(t){var i=this.spatialReference;if(t=t||i._getInfo()){var n=this._getCM(t);if(n){var e=i.isWebMercator?m.webMercatorToGeographic(n):n;this.xmin-=n.x,this.xmax-=n.x,i.isWebMercator||(e.x=this._normalizeX(e.x,t).x),this.spatialReference=new a(s.substitute({Central_Meridian:e.x},4326===i.wkid?t.altTemplate:t.wkTemplate))}}return this},_getCM:function(t){var i,n=t.valid[0],e=t.valid[1],s=this.xmin,a=this.xmax,r=s>=n&&e>=s,h=a>=n&&e>=a;return r&&h||(i=this.center),i},_normalize:function(t,n,e){var s=this.spatialReference;if(s&&(e=e||s._getInfo())){var a=i.map(this._getParts(e),function(t){return t.extent});if(a.length>2)return t?this._shiftCM(e):this.set({xmin:e.valid[0],xmax:e.valid[1]});if(2===a.length){if(t)return this._shiftCM(e);if(n)return a;var r=!0,h=!0;return i.map(a,function(t){t.hasZ||(r=!1),t.hasM||(h=!1)}),{rings:i.map(a,function(t){var i=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(r)for(var n=(t.zmax-t.zmin)/2,e=0;e<i.length;e++)i[e].push(n);if(h){var s=(t.mmax-t.mmin)/2;for(e=0;e<i.length;e++)i[e].push(s)}return i}),hasZ:r,hasM:h,spatialReference:s}}return a[0]||this}return this},_getParts:function(t){var i=this.cache._parts;if(!i){i=[];var n,e,s,a,r=this.xmin,h=this.xmax,m=this.ymin,x=this.ymax,o=this.spatialReference,f=this.width,u=r,l=h,y=0,p=0;if(t=t||o._getInfo(),e=t.valid[0],s=t.valid[1],n=this._normalizeX(r,t),r=n.x,y=n.frameId,n=this._normalizeX(h,t),h=n.x,p=n.frameId,a=r===h&&f>0,f>2*s){var d,z=new c(l>u?r:h,m,s,x,o),g=new c(e,m,l>u?h:r,x,o),v=new c(0,m,s,x,o),_=new c(e,m,0,x,o),M=[],w=[];for(z.contains(v)&&M.push(y),z.contains(_)&&w.push(y),g.contains(v)&&M.push(p),g.contains(_)&&w.push(p),d=y+1;p>d;d++)M.push(d),w.push(d);i.push({extent:z,frameIds:[y]},{extent:g,frameIds:[p]},{extent:v,frameIds:M},{extent:_,frameIds:w})}else r>h||a?i.push({extent:new c(r,m,s,x,o),frameIds:[y]},{extent:new c(e,m,h,x,o),frameIds:[p]}):i.push({extent:new c(r,m,h,x,o),frameIds:[y]});this.cache._parts=i}var R=this.hasZ,b=this.hasM;if(R||b){var C={};R&&(C.zmin=this.zmin,C.zmax=this.zmax),b&&(C.mmin=this.mmin,C.mmax=this.mmax);for(var Z=0;Z<i.length;Z++)i[Z].extent.set(C)}return i},_normalizeX:function(t,i){var n,e=0,s=i.valid[0],a=i.valid[1],r=2*a;return t>a?(n=Math.ceil(Math.abs(t-a)/r),t-=n*r,e=n):s>t&&(n=Math.ceil(Math.abs(t-s)/r),t+=n*r,e=-n),{x:t,frameId:e}},getWidth:function(){return e.deprecated(this.declaredClass+".getWidth","Use .width instead","4.0"),this.width},getHeight:function(){return e.deprecated(this.declaredClass+".getHeight","Use .height instead","4.0"),this.height},getCenter:function(){return e.deprecated(this.declaredClass+".getCenter","Use .center instead","4.0"),this.center},update:function(t,i,n,s,a){e.deprecated(this.declaredClass+".update","Use .set instead","4.0"),this.set({xmin:t,ymin:i,xmax:n,ymax:s,spatialReference:a})}});return c});