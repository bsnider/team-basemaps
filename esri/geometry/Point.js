// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.

define(["../core/declare","dojo/_base/lang","dojo/_base/kernel","./SpatialReference","./Geometry"],function(e,t,i,s,n){function a(e){return e*c}function r(e){return e*o}function u(e,t,i,s){t>89.99999?t=89.99999:-89.99999>t&&(t=-89.99999);var n=r(t);return s||(s=[0,0]),s[0]=r(e)*h,s[1]=h/2*Math.log((1+Math.sin(n))/(1-Math.sin(n))),s}function l(e,t,i,s){var n=a(e/h);return s||(s=[0,0]),s[0]=i?n:n-360*Math.floor((n+180)/360),s[1]=a(d/2-2*Math.atan(Math.exp(-1*t/h))),s}var h=6378137,d=3.141592653589793,c=57.29577951308232,o=.017453292519943,f=[0,0],p=e(n,{declaredClass:"esri.geometry.Point",classMetadata:{properties:{cache:{dependsOn:["x","y","z","m"]},hasM:{dependsOn:["m"]},hasZ:{dependsOn:["z"]},longitude:{dependsOn:["x"]},latitude:{dependsOn:["y"]}}},normalizeCtorArgs:function(e,i,n,a,r){var l;if(Array.isArray(e))l=e,r=i,e=l[0],i=l[1],n=l[2],a=l[3];else if(t.isObject(e)){if(l=e,e=null!=l.x?l.x:l.longitude,i=null!=l.y?l.y:l.latitude,n=null!=l.z?l.z:l.altitude,a=l.m,r=l.spatialReference,r&&"esri.SpatialReference"!==r.declaredClass&&(r=new s(r)),!l.declaredClass&&r&&r.isWebMercator&&null!=l.longitude&&null!=l.latitude){var h=u(l.longitude,l.latitude,!1,f);e=h[0],i=h[1]}}else this.isSR(n)?(r=n,n=null):this.isSR(a)&&(r=a,a=null);var d={x:e,y:i};return null!=r&&(d.spatialReference=r),null!=n&&(d.z=n),null!=a&&(d.m=a),d},_latitudeGetter:function(){var e=this.spatialReference;if(e){if(e.isWebMercator)return l(this.x,this.y,!1,f)[1];if(4326===e.wkid)return this.y}return null},_latitudeSetter:function(e){var t=this.spatialReference;t&&(t.isWebMercator?this.y=u(this.x,e,!1,f)[1]:4326===t.wkid&&(this.y=e))},_longitudeGetter:function(){var e=this.spatialReference;if(e){if(e.isWebMercator)return l(this.x,this.y,!1,f)[0];if(4326===e.wkid)return this.x}return null},_longitudeSetter:function(e){var t=this.spatialReference;t&&(t.isWebMercator?this.x=u(e,this.y,!1,f)[0]:4326===t.wkid&&(this.x=e))},_hasMGetter:function(){return void 0!==this.m},_hasMSetter:function(e,t){return e!==t?(this.m=e?0:void 0,e):t},_hasZGetter:function(){return void 0!==this.z},_hasZSetter:function(e,t){return e!==t?(this.z=e?0:void 0,e):t},x:0,y:0,z:void 0,m:void 0,type:"point",clone:function(){var e=new p;return e.x=this.x,e.y=this.y,e.z=this.z,e.m=this.m,e.spatialReference=this.spatialReference,e},copy:function(e){return p.copy(e,this),this},equals:function(e){if(!e)return!1;var t=this.x,i=this.y,s=this.z,n=this.m,a=this.spatialReference,r=e.x,h=e.y,d=e.z,c=e.m,o=e.spatialReference;if(!a.equals(o))if(a.isWebMercator&&4326===o.wkid){var f=u(r,h);r=f[0],h=f[1],o=a}else{if(4326!==a.wkid||!o.isWebMercator)return!1;var p=l(r,h);r=p[0],h=p[1],o=a}return t===r&&i===h&&s===d&&n===c&&a.wkid===o.wkid},offset:function(e,t,i){return this.x+=e,this.y+=t,null!=i&&this.hasZ&&(this.z+=i),this},normalize:function(){var e=this.x,t=this.spatialReference;if(t){var i=t._getInfo();if(i){var s,n=i.valid[0],a=i.valid[1],r=2*a;e>a?(s=Math.ceil(Math.abs(e-a)/r),e-=s*r):n>e&&(s=Math.ceil(Math.abs(e-n)/r),e+=s*r)}}return this.x=e,this},distance:function(e){return p.distance(this,e)},toArray:function(){var e=this.hasZ,t=this.hasM;return e&&t?[this.x,this.y,this.z,this.m]:e?[this.x,this.y,this.z]:t?[this.x,this.y,this.m]:[this.x,this.y]},toJSON:function(){var e=this.spatialReference,t={x:this.x,y:this.y};return this.hasZ&&(t.z=this.z),this.hasM&&(t.m=this.m),t.spatialReference=e&&e.toJSON(),t},setX:function(e){return i.deprecated(this.declaredClass+".setX","Use .x = value instead","4.0"),this.x=e,this},setY:function(e){return i.deprecated(this.declaredClass+".setY","Use .y = value instead","4.0"),this.y=e,this},setLongitude:function(e){return i.deprecated(this.declaredClass+".setLongitude","Use .longitude = value; instead","4.0"),this.longitude=e,this},setLatitude:function(e){return i.deprecated(this.declaredClass+".setLatitude","Use .latitude = value; instead","4.0"),this.latitude=e,this},getLongitude:function(){return i.deprecated(this.declaredClass+".getLongitude","Use .longitude instead","4.0"),this.longitude},getLatitude:function(){return i.deprecated(this.declaredClass+".getLatitude","Use .latitude instead","4.0"),this.latitude},update:function(e,t,s){i.deprecated(this.declaredClass+".update","Use .x/y/z = value instead","4.0");var n={x:e,y:t};return null!=s&&(n.z=s),this.set(n)}});return p.lngLatToXY=u,p.xyToLngLat=l,p.copy=function(e,t){t.x=e.x,t.y=e.y,t.z=e.z,t.m=e.m,t.spatialReference=Object.isFrozen(e.spatialReference)?e.spatialReference:e.spatialReference.clone()},p.distance=function(e,t){var i=e.x-t.x,s=e.y-t.y,n=e.hasZ&&t.hasZ?e.z-t.z:0;return Math.sqrt(i*i+s*s+n*n)},p});