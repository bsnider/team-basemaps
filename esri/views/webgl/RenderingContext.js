// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.

define(["require","exports","./enums"],function(t,e,i){var n=function(){function t(t){this._gl=null,this._extensions=void 0,this._blendEnabled=!1,this._blendColorState={r:0,g:0,b:0,a:0},this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this._blendEquationState={mode:32774,modeAlpha:32774},this._colorMaskState={r:!0,g:!0,b:!0,a:!0},this._polygonCullingEnabled=!1,this._cullFace=1029,this._frontFace=2305,this._scissorTestEnabled=!1,this._scissorRect={x:0,y:0,width:0,height:0},this._depthTestEnabled=!1,this._depthFunction=513,this._clearDepth=1,this._depthWriteEnabled=!0,this._depthRange={zNear:0,zFar:1},this._stencilTestEnabled=!1,this._stencilFunction={face:1032,func:519,ref:0,mask:1},this._clearStencil=0,this._stencilWriteMask=1,this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this._lineWidth=1,this._clearColor={r:0,g:0,b:0,a:0},this._activeShaderProgram=-1,this._activeVertexBuffer=-1,this._activeIndexBuffer=-1,this._activeVertexArrayObject=-1,this._activeFramebuffer=-1,this._activeTextureUnit=0,this._textureUnitMap={},this._gl=t,this._extensions=new s(t)}return Object.defineProperty(t.prototype,"gl",{get:function(){return this._gl},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._extensions},enumerable:!0,configurable:!0}),t.prototype.setBlendingEnabled=function(t){this._blendEnabled!==t&&(t===!0?this._gl.enable(this._gl.BLEND):this._gl.disable(this._gl.BLEND),this._blendEnabled=t)},t.prototype.setBlendColor=function(t,e,i,n){(t!==this._blendColorState.r||e!==this._blendColorState.g||i!==this._blendColorState.b||n!==this._blendColorState.a)&&(this._gl.blendColor(t,e,i,n),this._blendColorState.r=t,this._blendColorState.g=e,this._blendColorState.b=i,this._blendColorState.a=n)},t.prototype.setBlendFunction=function(t,e){(t!==this._blendFunctionState.srcRGB||e!==this._blendFunctionState.dstRGB)&&(this._gl.blendFunc(t,e),this._blendFunctionState.srcRGB=t,this._blendFunctionState.srcAlpha=t,this._blendFunctionState.dstRGB=e,this._blendFunctionState.dstAlpha=e)},t.prototype.setBlendFunctionSeparate=function(t,e,i,n){(this._blendFunctionState.srcRGB!==t||this._blendFunctionState.srcAlpha!==i||this._blendFunctionState.dstRGB!==e||this._blendFunctionState.dstAlpha!==n)&&(this._gl.blendFuncSeparate(t,e,i,n),this._blendFunctionState.srcRGB=t,this._blendFunctionState.srcAlpha=i,this._blendFunctionState.dstRGB=e,this._blendFunctionState.dstAlpha=n)},t.prototype.setBlendEquation=function(t){this._blendEquationState.mode!==t&&(this._gl.blendEquation(t),this._blendEquationState.mode=t,this._blendEquationState.modeAlpha=t)},t.prototype.setBlendEquationSeparate=function(t,e){(this._blendEquationState.mode!==t||this._blendEquationState.modeAlpha!==e)&&(this._gl.blendEquationSeparate(t,e),this._blendEquationState.mode=t,this._blendEquationState.modeAlpha=e)},t.prototype.seColorMask=function(t,e,i,n){(this._colorMaskState.r!==t||this._colorMaskState.g!==e||this._colorMaskState.b!==i||this._colorMaskState.a!==n)&&(this._gl.colorMask(t,e,i,n),this._colorMaskState.r=t,this._colorMaskState.g=e,this._colorMaskState.b=i,this._colorMaskState.a=n)},t.prototype.setClearColor=function(t,e,i,n){(this._clearColor.r!==t||this._clearColor.g!==e||this._clearColor.b!==i||this._clearColor.a!==n)&&(this._gl.clearColor(t,e,i,n),this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=i,this._clearColor.a=n)},t.prototype.setFaceCullingEnabled=function(t){this._polygonCullingEnabled!==t&&(t===!0?this._gl.enable(this._gl.CULL_FACE):this._gl.disable(this._gl.CULL_FACE),this._polygonCullingEnabled=t)},t.prototype.setCullFace=function(t){this._cullFace!==t&&(this._gl.cullFace(t),this._cullFace=t)},t.prototype.setFrontFace=function(t){this._frontFace!==t&&(this._gl.frontFace(t),this._frontFace=t)},t.prototype.setScissorTestEnabled=function(t){this._scissorTestEnabled!==t&&(t===!0?this._gl.enable(this._gl.SCISSOR_TEST):this._gl.disable(this._gl.SCISSOR_TEST),this._scissorTestEnabled=t)},t.prototype.setScissorRect=function(t,e,i,n){(this._scissorRect.x!==t||this._scissorRect.y!==e||this._scissorRect.width!==i||this._scissorRect.height!==n)&&(this._gl.scissor(t,e,i,n),this._scissorRect.x=t,this._scissorRect.y=e,this._scissorRect.width=i,this._scissorRect.height=n)},t.prototype.setDepthTestEnabled=function(t){this._depthTestEnabled!==t&&(t===!0?this._gl.enable(this._gl.DEPTH_TEST):this._gl.disable(this._gl.DEPTH_TEST),this._depthTestEnabled=t)},t.prototype.setClearDepth=function(t){this._clearDepth!==t&&(this._gl.clearDepth(t),this._clearDepth=t)},t.prototype.setDepthFunction=function(t){this._depthFunction!==t&&(this._gl.depthFunc(t),this._depthFunction=t)},t.prototype.setDepthWriteEnabled=function(t){this._depthWriteEnabled!==t&&(this._gl.depthMask(t),this._depthWriteEnabled=t)},t.prototype.setDepthRange=function(t,e){(this._depthRange.zNear!==t||this._depthRange.zFar!==e)&&(this._gl.depthRange(t,e),this._depthRange.zNear=t,this._depthRange.zFar=e)},t.prototype.setStencilTestEnabled=function(t){this._stencilTestEnabled!==t&&(t===!0?this._gl.enable(this._gl.STENCIL_TEST):this._gl.disable(this._gl.STENCIL_TEST),this._stencilTestEnabled=t)},t.prototype.setClearStencil=function(t){t!==this._clearStencil&&(this._gl.clearStencil(t),this._clearStencil=t)},t.prototype.setStencilFunction=function(t,e,i){(this._stencilFunction.func!==t||this._stencilFunction.ref!==e||this._stencilFunction.mask!==i)&&(this._gl.stencilFunc(t,e,i),this._stencilFunction.face=1032,this._stencilFunction.func=t,this._stencilFunction.ref=e,this._stencilFunction.mask=i)},t.prototype.setStencilFunctionSeparate=function(t,e,i,n){(this._stencilFunction.face!==t||this._stencilFunction.func!==e||this._stencilFunction.ref!==i||this._stencilFunction.mask!==n)&&(this._gl.stencilFuncSeparate(t,e,i,n),this._stencilFunction.face=t,this._stencilFunction.func=e,this._stencilFunction.ref=i,this._stencilFunction.mask=n)},t.prototype.setStencilWriteMask=function(t){this._stencilWriteMask!==t&&(this._gl.stencilMask(t),this._stencilWriteMask=t)},t.prototype.setStenciOp=function(t,e,i){(this._stencilOperation.fail!==t||this._stencilOperation.zFail!==e||this._stencilOperation.zPass!==i)&&(this._gl.stencilOp(t,e,i),this._stencilOperation.face=1032,this._stencilOperation.fail=t,this._stencilOperation.zFail=e,this._stencilOperation.zPass=i)},t.prototype.setStenciOpSeparate=function(t,e,i,n){(this._stencilOperation.face!==t||this._stencilOperation.fail!==e||this._stencilOperation.zFail!==i||this._stencilOperation.zPass!==n)&&(this._gl.stencilOpSeparate(t,e,i,n),this._stencilOperation.face=t,this._stencilOperation.face=t,this._stencilOperation.fail=e,this._stencilOperation.zFail=i,this._stencilOperation.zPass=n)},t.prototype.setLineWidth=function(t){var e=this._lineWidth;return this._lineWidth!==t&&(this._gl.lineWidth(t),this._lineWidth=t),e},t.prototype.setActiveTexture=function(t){var e=this._activeTextureUnit;return t>=0&&t!==this._activeTextureUnit&&(this._gl.activeTexture(i.BASE_TEXTURE_UNIT+t),this._activeTextureUnit=t),e},t.prototype.clear=function(t){t&&this._gl.clear(t)},t.prototype.drawArrays=function(t,e,i){this._gl.drawArrays(t,e,i)},t.prototype.drawElements=function(t,e,i,n){return 5123===i?void this._gl.drawElements(t,e,i,n):void(5125===i&&this._extensions.elementIndexUint?this._gl.drawElements(t,e,i,n):console.warn("Data type is uint however extension OES_Element_index_unit is not supported therefore this draw call cannot be made"))},t.prototype.drawArraysInstanced=function(t,e,i,n){this._extensions.angleInstancedArrays?this._extensions.angleInstancedArrays.drawArraysInstancedANGLE(t,e,i,n):console.error("Extension ANGLE_instanced_arrays isn't supported!")},t.prototype.drawElementsInstanced=function(t,e,i,n,s){this._extensions.angleInstancedArrays?this._extensions.angleInstancedArrays.drawElementsInstancedANGLE(t,e,i,n,s):console.error("Extension ANGLE_instanced_arrays isn't supported!")},t.prototype.setViewport=function(t,e,i,n){this._gl.viewport(t,e,i,n)},t.prototype.bindProgram=function(t){if(!t)return this._gl.useProgram(null),void(this._activeShaderProgram=-1);var e=t.id;this._activeShaderProgram!==e&&(t.initialize(),this._gl.useProgram(t.glName),this._activeShaderProgram=e)},t.prototype.bindTexture=function(e,i){if(void 0===i&&(i=0),-1===t._MAX_TEXTURE_IMAGE_UNITS&&(t._MAX_TEXTURE_IMAGE_UNITS=this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS)),(i>=t._MAX_TEXTURE_IMAGE_UNITS||0>i)&&console.error("Input texture unit is out of range of available units!"),this.setActiveTexture(i),!e)return this._gl.bindTexture(e.descriptor.target,null),void(this._textureUnitMap[i]=null);var n=this._textureUnitMap[i];return void 0!==n&&n.id===e.id?void e.applyChanges():(this._gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),void(void 0===n?this._textureUnitMap[i]={id:e.id}:n.id=e.id))},t.prototype.bindFramebuffer=function(t){if(!t)return this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,null),void(this._activeFramebuffer=-1);if(void 0!==t.id){var e=t.id;if(this._activeFramebuffer===e)return}t.initialize()||this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,t.glName),this._activeFramebuffer=t.id},t.prototype.bindBuffer=function(e){e&&(34962===e.bufferType?this._activeVertexBuffer=t._bindBuffer(this._gl,e,e.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=t._bindBuffer(this._gl,e,e.bufferType,this._activeIndexBuffer))},t.prototype.bindVAO=function(t){var e=this._extensions.vao;if(!t&&e)return e.bindVertexArrayOES(null),void(this._activeVertexArrayObject=-1);var i=t.id;this._activeVertexArrayObject!==i&&(t.initialize(),e?e.bindVertexArrayOES(t.glName):t.bindLayout(),this._activeVertexArrayObject=t.id)},t._bindBuffer=function(t,e,i,n){if(!e)return t.bindBuffer(i,null),-1;var s=e.id;return n===s?n:(t.bindBuffer(i,e.glName),s)},t._MAX_TEXTURE_IMAGE_UNITS=-1,t}(),s=function(){function t(t){this._vaoInit=!1,this._angleInstancedArraysInit=!1,this._standardDerivativesInit=!1,this._elementIndexUintInit=!1,this._depthTextureInit=!1,this._gl=t}return Object.defineProperty(t.prototype,"vao",{get:function(){return this._vaoInit||(this._vao=this._gl.getExtension("OES_vertex_array_object")||this._gl.getExtension("MOZ_OES_vertex_array_object")||this._gl.getExtension("WEBKIT_OES_vertex_array_object"),this._vaoInit=!0),this._vao},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angleInstancedArrays",{get:function(){return this._angleInstancedArraysInit||(this._angleInstancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._angleInstancedArraysInit=!0),this._angleInstancedArrays},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"standardDerivatives",{get:function(){return this._standardDerivativesInit||(this._standardDerivatives=this._gl.getExtension("OES_standard_derivatives"),this._standardDerivativesInit=!0),this._standardDerivatives},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"elementIndexUint",{get:function(){return this._elementIndexUintInit||(this._elementIndexUint=this._gl.getExtension("OES_element_index_uint"),this._elementIndexUintInit=!0),this._elementIndexUint},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depthTexture",{get:function(){return this._depthTextureInit||(this._depthTexture=this._gl.getExtension("WEBGL_depth_texture")||this._gl.getExtension("MOZ_WEBGL_depth_texture")||this._gl.getExtension("WEBKIT_WEBGL_depth_texture"),this._depthTextureInit=!0),this._depthTexture},enumerable:!0,configurable:!0}),t}();return n});