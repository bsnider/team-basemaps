// COPYRIGHT Â© 2016 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/4.0/esri/copyright.txt for details.

define([],function(){"use strict";function e(e,i,x){x=x||2;var u=i&&i.length,f=u?i[0]*x:e.length,o=t(e,n(e,0,f,x,!0)),p=[];if(!o)return p;var l,Z,a,h,c,s,d;if(u&&(o=v(e,i,o,x)),e.length>80*x){l=a=e[0],Z=h=e[1];for(var w=x;f>w;w+=x)c=e[w],s=e[w+1],l>c&&(l=c),Z>s&&(Z=s),c>a&&(a=c),s>h&&(h=s);d=Math.max(a-l,h-Z)}return r(e,o,p,x,l,Z,d),p}function n(e,n,t,r,i){var x,u,v,f=0;for(x=n,u=t-r;t>x;x+=r)f+=(e[u]-e[x])*(e[x+1]+e[u+1]),u=x;if(i===f>0)for(x=n;t>x;x+=r)v=M(x,v);else for(x=t-r;x>=n;x-=r)v=M(x,v);return v}function t(e,n,t){t||(t=n);var r,i=n;do if(r=!1,i.steiner||!s(e,i.i,i.next.i)&&0!==c(e,i.prev.i,i.i,i.next.i))i=i.next;else{if(i.prev.next=i.next,i.next.prev=i.prev,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ),i=t=i.prev,i===i.next)return null;r=!0}while(r||i!==t);return t}function r(e,n,v,f,o,l,Z,a){if(n){a||void 0===o||p(e,n,o,l,Z);for(var h,c,s=n;n.prev!==n.next;)if(h=n.prev,c=n.next,i(e,n,o,l,Z))v.push(h.i/f),v.push(n.i/f),v.push(c.i/f),c.prev=h,h.next=c,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ),n=c.next,s=c.next;else if(n=c,n===s){a?1===a?(n=x(e,n,v,f),r(e,n,v,f,o,l,Z,2)):2===a&&u(e,n,v,f,o,l,Z):r(e,t(e,n),v,f,o,l,Z,1);break}}}function i(e,n,t,r,i){var x=n.prev.i,u=n.i,v=n.next.i,f=e[x],o=e[x+1],p=e[u],l=e[u+1],a=e[v],h=e[v+1],c=f*l-o*p,s=f*h-o*a,d=a*l-h*p,w=c-s-d;if(0>=w)return!1;var z,g,b,M,k,m,j,q=h-o,y=f-a,A=o-l,B=p-f;if(void 0!==t){var C=p>f?a>f?f:a:a>p?p:a,D=l>o?h>o?o:h:h>l?l:h,E=f>p?f>a?f:a:p>a?p:a,F=o>l?o>h?o:h:l>h?l:h,G=Z(C,D,t,r,i),H=Z(E,F,t,r,i);for(j=n.nextZ;j&&j.z<=H;)if(z=j.i,j=j.nextZ,z!==x&&z!==v&&(g=e[z],b=e[z+1],M=q*g+y*b-s,M>=0&&(k=A*g+B*b+c,k>=0&&(m=w-M-k,m>=0&&(M&&k||M&&m||k&&m)))))return!1;for(j=n.prevZ;j&&j.z>=G;)if(z=j.i,j=j.prevZ,z!==x&&z!==v&&(g=e[z],b=e[z+1],M=q*g+y*b-s,M>=0&&(k=A*g+B*b+c,k>=0&&(m=w-M-k,m>=0&&(M&&k||M&&m||k&&m)))))return!1}else for(j=n.next.next;j!==n.prev;)if(z=j.i,j=j.next,g=e[z],b=e[z+1],M=q*g+y*b-s,M>=0&&(k=A*g+B*b+c,k>=0&&(m=w-M-k,m>=0&&(M&&k||M&&m||k&&m))))return!1;return!0}function x(e,n,t,r){var i=n;do{var x=i.prev,u=i.next.next;if(x.i!==u.i&&d(e,x.i,i.i,i.next.i,u.i)&&z(e,x,u)&&z(e,u,x)){t.push(x.i/r),t.push(i.i/r),t.push(u.i/r),x.next=u,u.prev=x;var v=i.prevZ,f=i.nextZ&&i.nextZ.nextZ;v&&(v.nextZ=f),f&&(f.prevZ=v),i=n=u}i=i.next}while(i!==n);return i}function u(e,n,i,x,u,v,f){var o=n;do{for(var p=o.next.next;p!==o.prev;){if(o.i!==p.i&&h(e,o,p)){var l=b(o,p);return o=t(e,o,o.next),l=t(e,l,l.next),r(e,o,i,x,u,v,f),void r(e,l,i,x,u,v,f)}p=p.next}o=o.next}while(o!==n)}function v(e,r,i,x){var u,v,o,p,l,Z=[];for(u=0,v=r.length;v>u;u++)o=r[u]*x,p=v-1>u?r[u+1]*x:e.length,l=n(e,o,p,x,!1),l===l.next&&(l.steiner=!0),l=t(e,l),l&&Z.push(a(e,l));for(Z.sort(function(n,t){return e[n.i]-e[t.i]}),u=0;u<Z.length;u++)f(e,Z[u],i),i=t(e,i,i.next);return i}function f(e,n,r){if(r=o(e,n,r)){var i=b(r,n);t(e,i,i.next)}}function o(e,n,t){var r,i,x,u=t,v=n.i,f=e[v],o=e[v+1],p=-1/0;do{if(i=u.i,x=u.next.i,o<=e[i+1]&&o>=e[x+1]){var l=e[i]+(o-e[i+1])*(e[x]-e[i])/(e[x+1]-e[i+1]);f>=l&&l>p&&(p=l,r=e[i]<e[x]?u:u.next)}u=u.next}while(u!==t);if(!r)return null;var Z,a,h,c,s,d,w=e[r.i],g=e[r.i+1],b=f*g-o*w,M=f*o-o*p,k=o-o,m=f-p,j=o-g,q=w-f,y=b-M-(p*g-o*w),A=0>=y?-1:1,B=r,C=1/0;for(u=r.next;u!==B;)Z=e[u.i],a=e[u.i+1],h=f-Z,h>=0&&Z>=w&&(c=(k*Z+m*a-M)*A,c>=0&&(s=(j*Z+q*a+b)*A,s>=0&&y*A-c-s>=0&&(d=Math.abs(o-a)/h,C>d&&z(e,u,n)&&(r=u,C=d)))),u=u.next;return r}function p(e,n,t,r,i){var x=n;do null===x.z&&(x.z=Z(e[x.i],e[x.i+1],t,r,i)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==n);x.prevZ.nextZ=null,x.prevZ=null,l(x)}function l(e){var n,t,r,i,x,u,v,f,o=1;do{for(t=e,e=null,x=null,u=0;t;){for(u++,r=t,v=0,n=0;o>n&&(v++,r=r.nextZ,r);n++);for(f=o;v>0||f>0&&r;)0===v?(i=r,r=r.nextZ,f--):0!==f&&r?t.z<=r.z?(i=t,t=t.nextZ,v--):(i=r,r=r.nextZ,f--):(i=t,t=t.nextZ,v--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;t=r}x.nextZ=null,o*=2}while(u>1);return e}function Z(e,n,t,r,i){return e=1e3*(e-t)/i,e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),n=1e3*(n-r)/i,n=16711935&(n|n<<8),n=252645135&(n|n<<4),n=858993459&(n|n<<2),n=1431655765&(n|n<<1),e|n<<1}function a(e,n){var t=n,r=n;do e[t.i]<e[r.i]&&(r=t),t=t.next;while(t!==n);return r}function h(e,n,t){return n.next.i!==t.i&&n.prev.i!==t.i&&!w(e,n,n.i,t.i)&&z(e,n,t)&&z(e,t,n)&&g(e,n,n.i,t.i)}function c(e,n,t,r){var i=(e[t+1]-e[n+1])*(e[r]-e[t])-(e[t]-e[n])*(e[r+1]-e[t+1]);return i>0?1:0>i?-1:0}function s(e,n,t){return e[n]===e[t]&&e[n+1]===e[t+1]}function d(e,n,t,r,i){return c(e,n,t,r)!==c(e,n,t,i)&&c(e,r,i,n)!==c(e,r,i,t)}function w(e,n,t,r){var i=n;do{var x=i.i,u=i.next.i;if(x!==t&&u!==t&&x!==r&&u!==r&&d(e,x,u,t,r))return!0;i=i.next}while(i!==n);return!1}function z(e,n,t){return-1===c(e,n.prev.i,n.i,n.next.i)?-1!==c(e,n.i,t.i,n.next.i)&&-1!==c(e,n.i,n.prev.i,t.i):-1===c(e,n.i,t.i,n.prev.i)||-1===c(e,n.i,n.next.i,t.i)}function g(e,n,t,r){var i=n,x=!1,u=(e[t]+e[r])/2,v=(e[t+1]+e[r+1])/2;do{var f=i.i,o=i.next.i;e[f+1]>v!=e[o+1]>v&&u<(e[o]-e[f])*(v-e[f+1])/(e[o+1]-e[f+1])+e[f]&&(x=!x),i=i.next}while(i!==n);return x}function b(e,n){var t=new k(e.i),r=new k(n.i),i=e.next,x=n.prev;return e.next=n,n.prev=e,t.next=i,i.prev=t,r.next=t,t.prev=r,x.next=r,r.prev=x,r}function M(e,n){var t=new k(e);return n?(t.next=n.next,t.prev=n,n.next.prev=t,n.next=t):(t.prev=t,t.next=t),t}function k(e){this.i=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}return e});